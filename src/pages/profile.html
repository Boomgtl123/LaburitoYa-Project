<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Mi Perfil - LaburitoYa</title>
  <link rel="stylesheet" href="../css/home.css" />
  <link rel="stylesheet" href="../css/home-responsive-additions.css" />
  <link rel="stylesheet" href="../css/mobile-avatar-menu.css" />
  <link rel="stylesheet" href="../css/profile-instagram.css" />
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-left">
        <button class="nav-hamburger" id="navHamburger">⋮</button>
        
        <div class="nav-btn nav-dropdown" id="navNotificaciones">
          <img src="../../assets/images/notificaciones.png" alt="Notificaciones" class="nav-icon-img" />
          <span class="notification-badge" id="notificationsBadgeIcon" style="display: none;">0</span>
          <div class="dropdown-menu dropdown-notifications">
            <div class="notifications-header">
              <h3>Notificaciones</h3>
              <button class="btn-mark-read" id="btnMarkAllRead">Marcar todas como leídas</button>
            </div>
            <div class="notifications-tabs">
              <button class="notif-tab active" data-tab="destacadas">⭐ Destacadas</button>
              <button class="notif-tab" data-tab="tendencias">📈 Tendencias</button>
              <button class="notif-tab" data-tab="recientes">🕐 Recientes</button>
            </div>
            <div class="notifications-content" id="notificationsContent">
              <div class="loading-notifications">Cargando notificaciones...</div>
            </div>
          </div>
        </div>
        <a href="home.html" class="nav-btn">
          <span>INICIO</span>
        </a>
        <a href="empleos.html" class="nav-btn">
          <span>EMPLEOS</span>
        </a>
      </div>

      <div class="nav-center">
        <a href="home.html" style="display: flex; align-items: center; text-decoration: none;">
          <img src="../../assets/images/logo.png" alt="LaburitoYa" class="nav-logo" style="cursor: pointer;" />
        </a>
      </div>

      <div class="nav-right">
        <a href="messages.html" class="nav-btn">
          <span>MENSAJES</span>
          <span class="notification-badge" id="notificationsBadge" style="display: none;">0</span>
        </a>
        <div class="nav-btn nav-dropdown" id="navInfo">
          <span>+ INFO</span>
          <div class="dropdown-menu dropdown-info">
            <div class="search-box-dropdown">
              <span class="search-icon">🔍</span>
              <input type="text" id="searchInput" placeholder="Buscar empleos, personas..." />
            </div>
            <div class="search-results-dropdown" id="searchResultsDropdown" style="display: none;"></div>
            <div class="dropdown-divider"></div>
            <a href="quienes-somos.html" class="dropdown-item">
              <span>👥</span> Quiénes somos
            </a>
            <a href="politicas.html" class="dropdown-item">
              <span>📋</span> Políticas
            </a>
            <a href="#" class="dropdown-item" id="btnCerrarSesion">
              <span>🚪</span> Cerrar sesión
            </a>
          </div>
        </div>
        <div class="nav-btn nav-dropdown nav-avatar-btn" id="navPerfil">
          <img src="https://via.placeholder.com/40" alt="Perfil" class="nav-avatar" id="navAvatar" style="cursor: pointer;" />
          <!-- Dropdown del avatar (visible en móvil) -->
          <div class="dropdown-menu dropdown-avatar">
            <a href="profile.html" class="dropdown-item">
              <span>👤</span> Ver perfil
            </a>
            <div class="dropdown-divider"></div>
            <div class="search-box-dropdown">
              <span class="search-icon">🔍</span>
              <input type="text" id="searchInputAvatar" placeholder="Buscar empleos, personas..." />
            </div>
            <div class="search-results-dropdown" id="searchResultsDropdownAvatar" style="display: none;"></div>
            <div class="dropdown-divider"></div>
            <a href="home.html" class="dropdown-item">
              <span>🏠</span> Inicio
            </a>
            <a href="empleos.html" class="dropdown-item">
              <span>💼</span> Empleos
            </a>
            <a href="messages.html" class="dropdown-item">
              <span>💬</span> Mensajes
            </a>
            <div class="dropdown-divider"></div>
            <a href="quienes-somos.html" class="dropdown-item">
              <span>👥</span> Quiénes somos
            </a>
            <a href="politicas.html" class="dropdown-item">
              <span>📋</span> Políticas
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item" id="btnCerrarSesionAvatar">
              <span>🚪</span> Cerrar sesión
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Menú móvil -->
    <div class="mobile-menu" id="mobileMenu">
      <a href="home.html" class="mobile-menu-item">INICIO</a>
      <a href="empleos.html" class="mobile-menu-item">EMPLEOS</a>
      <a href="messages.html" class="mobile-menu-item">MENSAJES</a>
      <a href="quienes-somos.html" class="mobile-menu-item">Quiénes somos</a>
      <a href="politicas.html" class="mobile-menu-item">Políticas</a>
      <a href="#" class="mobile-menu-item" id="mobileLogout">Cerrar sesión</a>
    </div>
  </nav>

  <!-- Contenedor del perfil estilo Instagram -->
  <div class="profile-instagram-container">
    
    <!-- Banner del perfil -->
    <div class="profile-banner" id="profileBanner">
      <div class="profile-banner-content"></div>
    </div>

    <!-- Header del perfil -->
    <div class="profile-header-wrapper">
      <header class="profile-instagram-header">
      <!-- Foto de perfil -->
      <div class="profile-instagram-photo-wrapper">
        <img src="https://via.placeholder.com/150" alt="Foto de perfil" id="profilePhoto" class="profile-instagram-photo" />
        <button class="profile-change-photo-btn" id="btnChangePhoto" title="Cambiar foto">
          📷
        </button>
        <input type="file" id="photoInput" accept="image/*" style="display: none;" />
      </div>

      <!-- Información del perfil -->
      <div class="profile-instagram-info">
        <!-- Línea 1: Botones de acción -->
        <div class="profile-instagram-top-row">
          <div class="profile-instagram-actions">
            <button class="profile-btn profile-btn-secondary" id="btnEditProfile">
              <span class="profile-btn-icon">✏️</span>
              <span>Editar perfil</span>
            </button>
            <button class="profile-btn profile-btn-secondary" id="btnShareProfile">
              <span class="profile-btn-icon">🔗</span>
              <span>Compartir</span>
            </button>
          </div>
        </div>

        <!-- Línea 2: Estadísticas -->
        <div class="profile-instagram-stats">
          <div class="profile-stat-item">
            <span class="profile-stat-number" id="statPosts">0</span>
            <span class="profile-stat-label">publicaciones</span>
          </div>
          <div class="profile-stat-item clickable" id="statSeguidoresBox">
            <span class="profile-stat-number" id="statSeguidores">0</span>
            <span class="profile-stat-label">seguidores</span>
          </div>
          <div class="profile-stat-item clickable" id="statSeguidosBox">
            <span class="profile-stat-number" id="statSeguidos">0</span>
            <span class="profile-stat-label">siguiendo</span>
          </div>
        </div>

        <!-- Botón de estadísticas detalladas -->
        <button class="profile-stats-btn" id="btnViewStats">
          <span>📊</span>
          <span>Ver estadísticas detalladas</span>
        </button>

        <!-- Línea 3: Información del usuario -->
        <div class="profile-instagram-details">
          <h2 class="profile-full-name" id="profileFullName">
            Nombre Completo
            <img src="../../assets/images/verificado.png" alt="Verificado" class="verified-badge" id="profileVerifiedBadge" style="display: none;" />
          </h2>
          <div class="profile-instagram-username" id="profileUsername">@cargando</div>
          <p class="profile-bio" id="profileBio">Bio del usuario...</p>
          <div class="profile-contact-row">
            <span class="profile-contact-item" id="profileType">
              💼 Tipo de perfil
            </span>
            <span class="profile-contact-item" id="profileLocation">
              📍 Ubicación
            </span>
            <span class="profile-contact-item" id="profileContact">
              📞 Contacto
            </span>
          </div>
          
          <!-- Redes sociales -->
          <div class="profile-social-links" id="profileSocialLinks">
            <!-- Los botones de redes sociales se generarán dinámicamente -->
          </div>
        </div>
      </div>
    </header>
    </div>

    <!-- Tabs de navegación -->
    <div class="profile-content-wrapper">
    <nav class="profile-instagram-tabs">
      <button class="profile-tab active" data-tab="posts">
        <span class="profile-tab-icon">📱</span>
        <span>Publicaciones</span>
      </button>
      <button class="profile-tab" data-tab="saved">
        <span class="profile-tab-icon">🔖</span>
        <span>Guardados</span>
      </button>
    </nav>

    </div>

    <!-- Grid de publicaciones -->
    <div class="profile-posts-grid" id="profilePostsGrid">
      <!-- Las publicaciones se cargarán dinámicamente aquí -->
      <div class="profile-no-posts">
        <div class="profile-no-posts-icon">📷</div>
        <h3>No hay publicaciones aún</h3>
        <p>Cuando publiques fotos y videos, aparecerán aquí.</p>
      </div>
    </div>

  </div>

  <!-- Modal de edición de perfil -->
  <div class="profile-edit-modal" id="profileEditModal">
    <div class="profile-edit-content">
      <div class="profile-edit-header">
        <h3 class="profile-edit-title">Editar perfil</h3>
        <button class="profile-edit-close" id="btnCloseEditModal">✕</button>
      </div>
      
      <div class="profile-edit-body">
        <form class="profile-edit-form" id="profileEditForm">
          
          <div class="profile-form-group">
            <label class="profile-form-label" for="editNombre">Nombre completo</label>
            <input type="text" class="profile-form-input" id="editNombre" required />
          </div>

          <div class="profile-form-group">
            <label class="profile-form-label" for="editUsername">Username</label>
            <input type="text" class="profile-form-input" id="editUsername" disabled />
            <span class="profile-form-hint">El username no se puede modificar</span>
          </div>

          <div class="profile-form-group">
            <label class="profile-form-label" for="editBio">Biografía</label>
            <textarea class="profile-form-textarea" id="editBio" maxlength="150" placeholder="Cuéntanos sobre ti..."></textarea>
            <span class="profile-form-hint" id="bioCounter">0 / 150</span>
          </div>

          <div class="profile-form-group">
            <label class="profile-form-label" for="editPerfil">Tipo de perfil</label>
            <select class="profile-form-select" id="editPerfil" required>
              <option value="Trabajador">Busco trabajo</option>
              <option value="Empleador">Busco contratar</option>
            </select>
          </div>

          <div class="profile-form-group">
            <label class="profile-form-label" for="editZona">Zona o ciudad</label>
            <input type="text" class="profile-form-input" id="editZona" required />
          </div>

          <div class="profile-form-group">
            <label class="profile-form-label" for="editTelefono">Teléfono</label>
            <input type="tel" class="profile-form-input" id="editTelefono" required />
          </div>

          <div class="profile-form-group">
            <label class="profile-form-label" for="editCorreo">Correo electrónico</label>
            <input type="email" class="profile-form-input" id="editCorreo" disabled />
            <span class="profile-form-hint">El correo no se puede modificar</span>
          </div>

          <!-- Selector de color del banner -->
          <div class="profile-banner-selector">
            <label class="profile-banner-selector-label">Color del banner</label>
            
            <!-- Preview del banner -->
            <div class="profile-banner-preview" id="bannerPreview"></div>
            
            <!-- Colores sólidos -->
            <div class="profile-color-options">
              <div class="profile-color-options-title">Colores sólidos</div>
              <div class="profile-color-grid" id="solidColorsGrid">
                <!-- Los colores se generarán dinámicamente -->
              </div>
            </div>
            
            <!-- Gradientes -->
            <div class="profile-color-options">
              <div class="profile-color-options-title">Gradientes</div>
              <div class="profile-gradient-grid" id="gradientsGrid">
                <!-- Los gradientes se generarán dinámicamente -->
              </div>
            </div>
          </div>

        </form>
      </div>

      <div class="profile-edit-footer">
        <button type="button" class="profile-btn-cancel" id="btnCancelEdit">Cancelar</button>
        <button type="submit" form="profileEditForm" class="profile-btn-save" id="btnSaveProfile">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Modal de publicación -->
  <div class="profile-post-modal" id="profilePostModal">
    <button class="profile-post-modal-close" id="btnClosePostModal">✕</button>
    <div class="profile-post-modal-content">
      <div class="profile-post-modal-image">
        <img src="" alt="Publicación" id="postModalImage" />
      </div>
      <div class="profile-post-modal-details">
        <div class="profile-post-modal-header">
          <img src="" alt="Usuario" class="profile-post-modal-avatar" id="postModalAvatar" />
          <div class="profile-post-modal-user">
            <div class="profile-post-modal-username" id="postModalUsername">@usuario</div>
          </div>
        </div>
        <!-- Aquí se pueden agregar más detalles de la publicación -->
      </div>
    </div>
  </div>

  <!-- Modal de estadísticas detalladas -->
  <div class="profile-stats-modal" id="profileStatsModal">
    <div class="profile-stats-content">
      <div class="profile-stats-header">
        <h3 class="profile-stats-title">
          <span>📊</span>
          <span>Estadísticas Detalladas</span>
        </h3>
        <button class="profile-stats-close" id="btnCloseStatsModal">✕</button>
      </div>
      
      <div class="profile-stats-body">
        <!-- Grid de estadísticas principales -->
        <div class="profile-stats-grid">
          <div class="profile-stat-card">
            <div class="profile-stat-card-icon">📱</div>
            <div class="profile-stat-card-value" id="statsDetailPosts">0</div>
            <div class="profile-stat-card-label">Publicaciones</div>
          </div>
          
          <div class="profile-stat-card">
            <div class="profile-stat-card-icon">❤️</div>
            <div class="profile-stat-card-value" id="statsDetailLikes">0</div>
            <div class="profile-stat-card-label">Likes totales</div>
          </div>
          
          <div class="profile-stat-card">
            <div class="profile-stat-card-icon">💬</div>
            <div class="profile-stat-card-value" id="statsDetailComments">0</div>
            <div class="profile-stat-card-label">Comentarios</div>
          </div>
          
          <div class="profile-stat-card">
            <div class="profile-stat-card-icon">👁️</div>
            <div class="profile-stat-card-value" id="statsDetailViews">0</div>
            <div class="profile-stat-card-label">Vistas de perfil</div>
          </div>
          
          <div class="profile-stat-card">
            <div class="profile-stat-card-icon">👥</div>
            <div class="profile-stat-card-value" id="statsDetailFollowers">0</div>
            <div class="profile-stat-card-label">Seguidores</div>
          </div>
          
          <div class="profile-stat-card">
            <div class="profile-stat-card-icon">🔗</div>
            <div class="profile-stat-card-value" id="statsDetailFollowing">0</div>
            <div class="profile-stat-card-label">Siguiendo</div>
          </div>
        </div>
        
        <div class="profile-stats-divider"></div>
        
        <!-- Información adicional -->
        <div class="profile-stats-info">
          <div class="profile-stat-info-item">
            <div class="profile-stat-info-icon">📅</div>
            <div class="profile-stat-info-content">
              <div class="profile-stat-info-label">Miembro desde</div>
              <div class="profile-stat-info-value" id="statsDetailMemberSince">Cargando...</div>
            </div>
          </div>
          
          <div class="profile-stat-info-item">
            <div class="profile-stat-info-icon">🕐</div>
            <div class="profile-stat-info-content">
              <div class="profile-stat-info-label">Última actividad</div>
              <div class="profile-stat-info-value" id="statsDetailLastActivity">Cargando...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Botón flotante de WhatsApp -->
  <a href="https://wa.me/5491234567890?text=Hola,%20necesito%20ayuda%20con%20LaburitoYa" 
     class="floating-contact-btn" 
     target="_blank" 
     rel="noopener noreferrer"
     aria-label="Contactar por WhatsApp">
  </a>

  <!-- Scripts -->
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <!-- Configuración de Firebase -->
  <script src="../../config/config.js"></script>
  <script src="../js/auth.js"></script>
  <script src="../js/followers.js"></script>
  <script src="../js/profile-instagram.js"></script>
  
  <!-- Scripts opcionales -->
  <script>
    const optionalScripts = ['../js/search.js', '../js/notifications.js', '../js/notifications-feed.js'];
    optionalScripts.forEach(script => {
      const scriptElement = document.createElement('script');
      scriptElement.src = script;
      scriptElement.onerror = () => console.warn(`⚠️ ${script} no disponible`);
      document.body.appendChild(scriptElement);
    });

    // Menú hamburguesa y dropdowns
    document.addEventListener('DOMContentLoaded', function() {
      const hamburger = document.getElementById('navHamburger');
      const mobileMenu = document.getElementById('mobileMenu');
      const mobileLogout = document.getElementById('mobileLogout');
      const navPerfil = document.getElementById('navPerfil');
      const navAvatar = document.getElementById('navAvatar');

      // Dropdown del avatar
      if (navPerfil && navAvatar) {
        navAvatar.addEventListener('click', function(e) {
          e.stopPropagation();
          const isMobile = window.innerWidth <= 768;
          
          if (isMobile) {
            // En móvil, toggle dropdown
            navPerfil.classList.toggle('active');
          } else {
            // En desktop, ir a perfil
            window.location.href = 'profile.html';
          }
        });
      }

      // Cerrar sesión desde el dropdown del avatar
      const btnCerrarSesionAvatar = document.getElementById('btnCerrarSesionAvatar');
      if (btnCerrarSesionAvatar) {
        btnCerrarSesionAvatar.addEventListener('click', function(e) {
          e.preventDefault();
          if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
            if (window.auth) {
              window.auth.cerrarSesion();
            } else {
              localStorage.removeItem('usuarioActual');
              window.location.href = 'login.html';
            }
          }
        });
      }

      // Búsqueda en el dropdown del avatar
      const searchInputAvatar = document.getElementById('searchInputAvatar');
      if (searchInputAvatar && window.search) {
        searchInputAvatar.addEventListener('input', function() {
          window.search.buscar(this.value, 'searchResultsDropdownAvatar');
        });
      }

      const navInfo = document.getElementById('navInfo');
      if (navInfo) {
        navInfo.addEventListener('click', function(e) {
          if (!e.target.closest('.dropdown-menu')) {
            this.classList.toggle('active');
          }
        });
      }

      const navNotificaciones = document.getElementById('navNotificaciones');
      if (navNotificaciones) {
        navNotificaciones.addEventListener('click', function(e) {
          if (!e.target.closest('.dropdown-menu')) {
            this.classList.toggle('active');
          }
        });
      }

      if (hamburger && mobileMenu) {
        hamburger.addEventListener('click', function(e) {
          e.stopPropagation();
          mobileMenu.classList.toggle('active');
        });

        document.addEventListener('click', function(e) {
          if (!mobileMenu.contains(e.target) && !hamburger.contains(e.target)) {
            mobileMenu.classList.remove('active');
          }
        });

        const menuItems = mobileMenu.querySelectorAll('.mobile-menu-item');
        menuItems.forEach(item => {
          item.addEventListener('click', function() {
            mobileMenu.classList.remove('active');
          });
        });
      }

      if (mobileLogout) {
        mobileLogout.addEventListener('click', function(e) {
          e.preventDefault();
          if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
            if (window.auth) {
              window.auth.cerrarSesion();
            } else {
              localStorage.removeItem('usuarioActual');
              window.location.href = 'login.html';
            }
          }
        });
      }

      const btnCerrarSesion = document.getElementById('btnCerrarSesion');
      if (btnCerrarSesion) {
        btnCerrarSesion.addEventListener('click', function(e) {
          e.preventDefault();
          if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
            if (window.auth) {
              window.auth.cerrarSesion();
            } else {
              localStorage.removeItem('usuarioActual');
              window.location.href = 'login.html';
            }
          }
        });
      }

      // Cerrar dropdowns al hacer clic fuera
      document.addEventListener('click', function(e) {
        if (navInfo && !navInfo.contains(e.target)) {
          navInfo.classList.remove('active');
        }
        if (navNotificaciones && !navNotificaciones.contains(e.target)) {
          navNotificaciones.classList.remove('active');
        }
        if (navPerfil && !navPerfil.contains(e.target)) {
          navPerfil.classList.remove('active');
        }
      });
    });
  </script>
</body>
</html>
